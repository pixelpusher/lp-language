(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("liveprinter-utils")):typeof define=="function"&&define.amd?define(["exports","liveprinter-utils"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a["lp-language"]={},a.liveprinterUtils))})(this,function(a,e){"use strict";const s=require("nearley"),i=require("./lpgrammar"),f=/(?:\n|\t|\s)*\#{2}\s*((?:.|\n|\t|\s)*)\#{2}/g,m=/(?:\n|\t|\s)*\#\s*((?:[^\n])*)/g,h=/[\n\s]*(lp)\./g;function w(r,u){const l=new s.Parser(s.Grammar.fromCompiled(i));return r=r.replace(f,(g,t)=>{e.Logger.debug("Match: "+t);let d="";return t.split(/[\r\n]/).map(n=>{n=n.replace(/([\r\n]+)/gm,"").replace(/(^[\s]+)/,""),n.length!==0&&l.feed(n+`
`)}),d+=l.results[0]," "+d+`
`}),e.Logger.info("code AFTER block-grammar processing -------------------------------"),e.Logger.info(r),e.Logger.info("========================= -------------------------------"),r=r.replace(m,(g,t,d)=>{const o=new s.Parser(s.Grammar.fromCompiled(i));e.Logger.debug("!!!"+g+"!!!"),e.Logger.debug("!!!"+t+"!!!");let n="",c=t.replace(/([\r\n]+)/gm,"").replace(/([\s]+)$/,"");return c&&(o.feed(c+`
`),n=o.results[0])," "+n}),u&&(r=r.replace(h,u)),e.Logger.debug("code AFTER one-line-grammar processing -------------------------------"),e.Logger.debug(r),e.Logger.debug("========================= -------------------------------"),r}const p=/^(stop|prime|mov2|ext|gcodeEvent|gcode|errorEvent|retractspeed|sendFirmwareRetractSettings|retract|unretract|start|temp|bed|fan|drawtime|draw|up|drawup|dup|upto|downto|down|drawdown|dd|travel|traveltime|fwretract|polygon|rect|extrudeto|sendExtrusionGCode|sendArcExtrusionGCode|extrude|move|moveto|drawfill|sync|fill|wait|pause|resume|printPaths|printPathsThick|_extrude)[^a-zA-Z0-9\_]/;function b(r){r.defineMode("lp",function(u,l){const g={token:function(t,d){let o="";if(!t.eol()){let n=t.match(p,!1);if(n){let c=n[1].length;for(;c--;)t.eat(()=>!0);return"lp"}}if(t.eatSpace(),t.match(p,!1))return null;for(;(o=t.eat(/[^\s]/))&&o!==".";);return null}};return r.overlayMode(r.getMode(u,l.backdrop||"javascript"),g)})}a.addCMMode=b,a.transpile=w,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
